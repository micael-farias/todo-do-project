<!-- app/views/boards/index.html.erb -->
<!-- app/views/boards/index.html.erb -->
<div class="mood-selection mb-4">
  <h2>Como você está se sentindo hoje?</h2>
  <%= form_with url: create_daily_board_boards_path, method: :post, remote: true, html: { id: 'daily-board-form' } do |f| %>
    <div class="moods-container">
      <% Mood.limit(6).each do |mood| %>
<div class="mood-item <%= 'selected' if current_user.moods.include?(mood) %>" data-mood-id="<%= mood.id %>">
  <img src="https://img.freepik.com/fotos-gratis/vitrine-de-produtos-com-fundo-de-sala-de-estudio-preto-em-destaque-como-montagem-para-exibicao-de-produtos_1258-108934.jpg" alt="<%= mood.name %>" class="mood-image">
  <p class="mood-name"><%= mood.name %></p>
</div>

      <% end %>
    </div>
    <%= hidden_field_tag :selected_mood_ids, '', id: 'selected_mood_ids' %>
    <%= submit_tag 'Enviar Humores', class: 'btn btn-primary mt-3' %>
  <% end %>
</div>

<!-- app/views/boards/produtividade.html.erb -->
<h1>Produtividade do Board: <%= current_user.name %> 10/50 cards completos</h1>

<div id="tasks-chart">
  <%= line_chart @cards_by_day, 
      xtitle: "Dias", 
      ytitle: "Tarefas Completadas", 
      title: "Tarefas Completadas por Dia",
      library: {
        scales: {
          x: { 
            type: 'time', 
            time: { unit: 'day' },
            title: { display: true, text: 'Dias' }
          },
          y: {
            beginAtZero: true,
            ticks: { precision: 0 },
            title: { display: true, text: 'Tarefas Completadas' }
          }
        }
      } 
  %>
</div>



<script>
  document.addEventListener('DOMContentLoaded', function() {
    const moodItems = document.querySelectorAll('.mood-item');
    const selectedMoodIdsField = document.getElementById('selected_mood_ids');

    moodItems.forEach(item => {
      item.addEventListener('click', function() {
        const moodId = this.getAttribute('data-mood-id');
        this.classList.toggle('selected');

        let selectedMoodIds = selectedMoodIdsField.value ? selectedMoodIdsField.value.split(',') : [];

        if (selectedMoodIds.includes(moodId)) {
          selectedMoodIds = selectedMoodIds.filter(id => id !== moodId);
        } else {
          selectedMoodIds.push(moodId);
        }

        selectedMoodIdsField.value = selectedMoodIds.join(',');
      });
    });

    // Handle form submission
    const form = document.getElementById('daily-board-form');
    form.addEventListener('submit', function(event) {
      event.preventDefault();
      
      const selectedMoodIds = selectedMoodIdsField.value.split(',').map(id => parseInt(id));

      if (selectedMoodIds.length === 0) {
        alert('Por favor, selecione pelo menos um humor.');
        return;
      }

      // Enviar via AJAX
      fetch(form.action, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
        },
        body: JSON.stringify({ mood_ids: selectedMoodIds })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          console.log('Humores enviados com sucesso:', data);
          // Opcional: redirecionar ou atualizar a interface
        } else {
          alert('Erro ao enviar humores: ' + data.error);
        }
      })
      .catch(error => {
        console.error('Erro:', error);
      });
    });
  });
</script>



<h1>Boards</h1>

<div class="board-container">
  <!-- Card para adicionar novo board -->
  <div class="board-card new-board-card">
    <%= link_to new_board_path, class: 'board-link' do %>
      <div class="card-body">
        <i class="bi bi-plus-lg" aria-label="Adicionar Novo Board"></i>
      </div>
    <% end %>
  </div>

  <!-- Cards dos boards existentes -->
  <% @boards.each do |board| %>
    <div class="board-card">
      <%= link_to board_path(board), class: 'board-link' do %>
        <div class="card-body">
          <h5 class="card-title"><%= board.title %></h5>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
